---
apiVersion: api.tsb.tetrate.io/v2
kind: WorkspaceSetting
metadata:
  displayName: default-setting
  name: default-setting
  organization: tetrate
  tenant: demo-apps
  workspace: wealth-mgmt
spec:
  defaultSecuritySetting:
    displayName: default-setting
  defaultTrafficSetting:
    displayName: default-setting
    egress:
      host: demo-security/demo-cluster-egress.demo-security.svc.cluster.local
  displayName: default-setting
---
apiVersion: gateway.tsb.tetrate.io/v2
kind: Group
metadata:
  tenant: demo-apps
  organization: tetrate
  workspace: wealth-mgmt
  name: egress
spec:
  displayName: Egress Gateway
  description: Egress Gateway
  namespaceSelector:
    names:
      - "*/demo-security"
  configMode: BRIDGED
---
apiVersion: gateway.tsb.tetrate.io/v2
kind: EgressGateway
metadata:
  displayName: default-egressgateway
  group: egress
  name: default-egressgateway
  organization: tetrate
  tenant: demo-apps
  workspace: wealth-mgmt
spec:
  displayName: default-egressgateway
  workloadSelector:
    labels:
      app: demo-cluster-egress
    namespace: demo-security
---
apiVersion: gateway.tsb.tetrate.io/v2
kind: Group
metadata:
  tenant: demo-apps
  organization: tetrate
  workspace: wealth-mgmt
  name: tier1-gw
spec:
  displayName: Tier 1 Gateway
  description: Tier 1 Gateway
  namespaceSelector:
    names:
      - "*/demo-app-tier1"
  configMode: BRIDGED
---
apiVersion: gateway.tsb.tetrate.io/v2
kind: Tier1Gateway
metadata:
  name: tier1-gateway
  group: tier1-gw
  workspace: wealth-mgmt
  tenant: demo-apps
  organization: tetrate
spec:
  workloadSelector:
    namespace: demo-app-tier1
    labels:
      app: demo-app-gateway
  externalServers:
  - hostname: frontend.tetrate.cloud.zwickey.net
    name: frontend
    port: 443
    tls:
      mode: SIMPLE
      secretName: frontend-cert
---
apiVersion: gateway.tsb.tetrate.io/v2
kind: Group
metadata:
  tenant: demo-apps
  organization: tetrate
  workspace: wealth-mgmt
  name: frontend-gw-01
spec:
  displayName: Frontend Gateway 01
  description: Frontend Gateway 01
  namespaceSelector:
    names:
      - "gke-east/demo-app"
  configMode: BRIDGED
---
apiVersion: gateway.tsb.tetrate.io/v2
kind: IngressGateway
metadata:
  name: app-gateway
  group: frontend-gw-01
  workspace: wealth-mgmt
  tenant: demo-apps
  organization: tetrate
spec:
  workloadSelector:
    namespace: demo-app
    labels:
      app: demo-app-gateway
  http:
    - name: frontend-gateway
      port: 443
      tls:
        mode: SIMPLE
        secretName: frontend-cert
      hostname: frontend.gke-east.tetrate.cloud.zwickey.net
      routing:
        rules:
          - route:
              host: "demo-app/frontend.demo-app.svc.cluster.local"
              port: 8888
    - name: frontend-internal
      port: 443
      tls:
        mode: SIMPLE
        secretName: frontend-cert
      hostname: frontend.tetrate.cloud.zwickey.net
      routing:
        rules:
          - route:
              host: "demo-app/frontend.demo-app.svc.cluster.local"
              port: 8888
    - name: backend-internal
      port: 80
      hostname: backend.demo.mesh
      routing:
        rules:
          - route:
              host: "demo-app/backend.demo-app.svc.cluster.local"
              port: 80
---
apiVersion: gateway.tsb.tetrate.io/v2
kind: Group
metadata:
  tenant: demo-apps
  organization: tetrate
  workspace: wealth-mgmt
  name: frontend-gw-02
spec:
  displayName: Frontend Gateway 02
  description: Frontend Gateway 02
  namespaceSelector:
    names:
      - "gke-west/demo-app"
  configMode: BRIDGED
---
apiVersion: gateway.tsb.tetrate.io/v2
kind: IngressGateway
metadata:
  name: app-gateway
  group: frontend-gw-02
  workspace: wealth-mgmt
  tenant: demo-apps
  organization: tetrate
spec:
  workloadSelector:
    namespace: demo-app
    labels:
      app: demo-app-gateway
  http:
    - name: frontend-gateway
      port: 443
      tls:
        mode: SIMPLE
        secretName: frontend-cert
      hostname: frontend.gke-west.tetrate.cloud.zwickey.net
      routing:
        rules:
          - route:
              host: "demo-app/frontend.demo-app.svc.cluster.local"
              port: 8888
    - name: frontend-internal
      port: 443
      tls:
        mode: SIMPLE
        secretName: frontend-cert
      hostname: frontend.tetrate.cloud.zwickey.net
      routing:
        rules:
          - route:
              host: "demo-app/frontend.demo-app.svc.cluster.local"
              port: 8888
    - name: backend-internal
      port: 80
      hostname: backend.demo.mesh
      routing:
        rules:
          - route:
              host: "demo-app/backend.demo-app.svc.cluster.local"
              port: 80
---
apiVersion: gateway.tsb.tetrate.io/v2
kind: Group
metadata:
  tenant: demo-apps
  organization: tetrate
  workspace: wealth-mgmt
  name: frontend-gw-03
spec:
  displayName: Frontend Gateway 03
  description: Frontend Gateway 03
  namespaceSelector:
    names:
      - "aws-east/demo-app"
  configMode: BRIDGED  
---
apiVersion: gateway.tsb.tetrate.io/v2
kind: IngressGateway
metadata:
  name: app-gateway
  group: frontend-gw-03
  workspace: wealth-mgmt
  tenant: demo-apps
  organization: tetrate
spec:
  workloadSelector:
    namespace: demo-app
    labels:
      app: demo-app-gateway
  http:
    - name: frontend-gateway
      port: 443
      tls:
        mode: SIMPLE
        secretName: frontend-cert
      hostname: frontend.aws-east.tetrate.cloud.zwickey.net
      routing:
        rules:
          - route:
              host: "demo-app/frontend.demo-app.svc.cluster.local"
              port: 8888
    - name: frontend-internal
      port: 443
      tls:
        mode: SIMPLE
        secretName: frontend-cert
      hostname: frontend.tetrate.cloud.zwickey.net
      routing:
        rules:
          - route:
              host: "demo-app/frontend.demo-app.svc.cluster.local"
              port: 8888
    - name: backend-internal
      port: 80
      hostname: backend.demo.mesh
      routing:
        rules:
          - route:
              host: "demo-app/backend.demo-app.svc.cluster.local"
              port: 80